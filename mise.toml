# æ‰‹æ›¸ãæ–‡æ›¸ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ãƒ»å¾©å…ƒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
# ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼è¨­å®š (mise)

[env]
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
PROJECT_ROOT = "{{ config_root }}"
# ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
DATA_DIR = "{{ config_root }}/data"
# ãƒ¢ãƒ‡ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
MODELS_DIR = "{{ config_root }}/data/models"

[tools]
# Python ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š
python = "3.12"

[tasks.setup]
description = "ç’°å¢ƒæ§‹ç¯‰: Pythonä»®æƒ³ç’°å¢ƒã®ä½œæˆã¨ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
run = """
#!/usr/bin/env bash
set -euo pipefail

echo "ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
uv venv
. .venv/bin/activate
uv sync

echo "ğŸ“ ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆä¸­..."
mkdir -p data/input data/output data/models

echo "âœ… ç’°å¢ƒæ§‹ç¯‰ãŒå®Œäº†ã—ã¾ã—ãŸ"
echo ""
echo "æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:"
echo "  mise run download-models  # å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"
echo "  mise run ocr <input>      # OCRå‡¦ç†ã®å®Ÿè¡Œ"
"""

[tasks.download-models]
description = "å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ (PaddleOCR, FontDiffuser)"
run = """
#!/usr/bin/env bash
set -euo pipefail

echo "ğŸ“¥ ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­..."
uv run python scripts/download_models.py

echo "âœ… ãƒ¢ãƒ‡ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ"
"""

[tasks.ocr]
description = "OCRå‡¦ç†ã®å®Ÿè¡Œ: ç”»åƒã‹ã‚‰æ–‡å­—ã‚’èªè­˜"
run = """
#!/usr/bin/env bash
set -euo pipefail

if [ $# -eq 0 ]; then
    echo "ä½¿ç”¨æ–¹æ³•: mise run ocr <input_path>"
    echo "  <input_path>: å…¥åŠ›ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª"
    exit 1
fi

uv run python -m src.load.pipeline "$@"
"""

[tasks.verify]
description = "TUIæ¤œè¨¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®èµ·å‹•: OCRçµæœã®ç¢ºèªã¨ä¿®æ­£"
run = """
#!/usr/bin/env bash
set -euo pipefail

if [ $# -eq 0 ]; then
    echo "ä½¿ç”¨æ–¹æ³•: mise run verify <json_path>"
    echo "  <json_path>: OCRçµæœã®JSONãƒ•ã‚¡ã‚¤ãƒ«"
    exit 1
fi

uv run python -m src.verify.app "$@"
"""

[tasks.generate]
description = "ãƒ•ã‚©ãƒ³ãƒˆç”Ÿæˆ: ã‚¹ã‚¿ã‚¤ãƒ«å‚ç…§ç”»åƒã‹ã‚‰å…¨æ–‡å­—ã‚’ç”Ÿæˆ"
run = """
#!/usr/bin/env bash
set -euo pipefail

if [ $# -lt 2 ]; then
    echo "ä½¿ç”¨æ–¹æ³•: mise run generate <style_ref> <output>"
    echo "  <style_ref>: ã‚¹ã‚¿ã‚¤ãƒ«å‚ç…§ç”»åƒ"
    echo "  <output>: å‡ºåŠ›ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ (.ttf/.otf)"
    exit 1
fi

uv run python -m src.generate.pipeline "$@"
"""

[tasks.test]
description = "ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ"
run = "uv run pytest tests/ -v"

[tasks.lint]
description = "ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯"
run = """
#!/usr/bin/env bash
set -euo pipefail

echo "ğŸ” Ruffã§ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ä¸­..."
uv run ruff check src/ tests/

echo "ğŸ¨ Ruffã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ä¸­..."
uv run ruff format --check src/ tests/

echo "âœ… ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸ"
"""

[tasks.format]
description = "ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"
run = """
#!/usr/bin/env bash
set -euo pipefail

echo "ğŸ¨ ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸­..."
uv run ruff format src/ tests/
uv run ruff check --fix src/ tests/

echo "âœ… ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ"
"""
